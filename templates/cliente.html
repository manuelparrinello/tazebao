{% extends "base.html" %}

{% block title %}Tutti i lavori{% endblock %}

{% block content %}
<div id="clientePage" data-cliente-id="{{ cliente.id }}">
    <div class="row mx-auto w-100 display-flex align-items-center justify-content-space-between">
        <div class="col-4 px-0">
            <h6 class="fw-bold text-primary" style="letter-spacing: 1.2px;">PAGINA CLIENTE</h6>
            <h1>{{ cliente.name }}</h1>
            <p>Totale lavori: <span class="fw-bold">[[ cliente.count_lavori ]]</span></p>
        </div>
        <div class="col-8 d-inline-flex justify-content-end px-0">
            <a href="{{ url_for('cliente_edit', cliente_id = cliente.id)}}"><button
                    class="btn btn-warning me-3 fw-bold"><span><i
                            class="bi bi-pencil"></i></span>&nbsp;Modifica</button></a>

            <button onclick="clickForDeleteCliente(event, {{ cliente.id }})" class="btn btn-danger fw-bold"><span><i
                        class="bi bi-trash3"></i></span>&nbsp;Elimina cliente</button>
        </div>
    </div>

    <div class="mb-5 mt-2" id="anagraficaCliente">
        <hr>
        <div class="row w-100">
            <h5 class="fw-bold">Anagrafica</h5>
        </div>
        <div class="row w-100">
            <div class="col-sm .col-lg-3">
                <strong>Nome</strong>: [[ cliente.nome ]]<br>
                <strong>Telefono</strong>: [[ cliente.telefono ]]<br>
            </div>
            <div class="col-sm .col-lg-3">
                <strong>Indirizzo email</strong>: [[ cliente.email ]]<br>
                <strong>Colore</strong>: <span :style="{ color : cliente.colore }" style="font-weight: bold;">[[
                    cliente.colore ]]</span><br>
            </div>
            <div class="col-sm .col-lg-3"><strong>Note</strong>: [[ cliente.note ]]</div>
        </div>
        <hr>
    </div>

    <div class="container p-0 mt-2">
        <h4 class="fw-bold">Lavori associati</h4>
        <table class="table sortable table-hover table-striped" id="tabellaLavori">
            <thead>
                <tr>
                    <th class="pointer" scope="col">#</th>
                    <th class="pointer" scope="col">Descrizione</th>
                    <th class="pointer" scope="col">Preventivato</th>
                    <th class="pointer" scope="col">Priorit√†</th>
                    <th class="pointer" scope="col">Stato</th>
                    <th class="pointer" scope="col">Data inizio</th>
                    <th class="pointer" scope="col">Data fine</th>
                    <th class="pointer" scope="col">Data pagamento</th>
                    <th class="pointer" scope="col">Note</th>

                </tr>
            </thead>
            <tbody>
                {% if cliente.lavori %}
                {% for lavoro in cliente.lavori %}
                <tr>
                    <th scope="row">{{ lavoro.id }}</th>
                    <td>{{ lavoro.descrizione }}</td>
                    <td>{{ lavoro.preventivato | euro }}</td>
                    <td class="text-center"><span class="prio-pill">{{ lavoro.priorita }}</span></td>
                    <td>{{ lavoro.stato if lavoro.stato else '-' }}</td>
                    <td>{{ lavoro.data_inizio if lavoro.data_inizio else '-' }}</td>
                    <td>{{ lavoro.data_fine if lavoro.data_fine else "-" }}</td>
                    <td>{{ lavoro.data_pagamento if lavoro.data_pagamento else "-" }}</td>
                    <td>{{ lavoro.note if lavoro.note else "-" }}</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="9" class="text-center">Nessun lavoro trovato per questo cliente.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script src="{{ url_for('static', filename='js/cliente.js') }}"></script>
{% endblock %}